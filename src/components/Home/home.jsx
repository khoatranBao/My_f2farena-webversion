// import React, { useState, useEffect } from 'react';
// import './home.css';

// // ‚úÖ B∆Ø·ªöC 1: Import c√°c h√†m API
// import { fetchTournaments } from '../../api/tournaments.js';
// import { fetchLiveMatches } from '../../api/matches.js';

// // Import c√°c component con
// import TournamentCard from '../tournament_card/TournamentCard.jsx';
// import LiveMatchCard from './LiveMatchCard.jsx';

// // --- ICONS (v·∫´n gi·ªØ l·∫°i v√¨ ch√∫ng l√† m·ªôt ph·∫ßn c·ªßa UI) ---
// const LiveIconNew = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="icon icon-red animate-pulse" viewBox="0 0 24 24" fill="currentColor"><path fillRule="evenodd" d="M12 1.5a1.05 1.05 0 100 2.1 1.05 1.05 0 000-2.1zM10.23 15.795a.75.75 0 001.06 0l4.5-4.5a.75.75 0 00-1.06-1.06L11.25 13.19l-1.97-1.97a.75.75 0 00-1.06 1.06l2.5 2.5z" clipRule="evenodd" /></svg> );
// const UpcomingTournamentIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="icon icon-blue"><path fillRule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z" clipRule="evenodd" /></svg> );
// const LiveMatchIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="icon icon-red"><path d="M4.5 9.75a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM12 9.75a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM19.5 9.75a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM4.5 16.5a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM12 16.5a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM19.5 16.5a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5z" /></svg> );


// const Home = ({ onlinePlayers, countdownTimers, formatTime, setViewingTournament }) => {
//     // ‚úÖ B∆Ø·ªöC 2: Th√™m state ƒë·ªÉ l∆∞u d·ªØ li·ªáu t·ª´ API
//     const [allTournaments, setAllTournaments] = useState([]);
//     const [liveMatches, setLiveMatches] = useState([]);
//     const [isLoading, setIsLoading] = useState(true);

//     const [visibleLiveTournaments, setVisibleLiveTournaments] = useState(3);
//     const [visibleUpcomingTournaments, setVisibleUpcomingTournaments] = useState(3);
    
//     // ‚úÖ B∆Ø·ªöC 3: D√πng useEffect ƒë·ªÉ g·ªçi ƒë·ªìng th·ªùi nhi·ªÅu API
//     useEffect(() => {
//         const loadAllHomeData = async () => {
//             setIsLoading(true);
//             try {
//                 // G·ªçi ƒë·ªìng th·ªùi c√°c API ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô t·∫£i
//                 const [tournamentsData, matchesData] = await Promise.all([
//                     fetchTournaments(),
//                     fetchLiveMatches()
//                 ]);
//                 setAllTournaments(tournamentsData);
//                 setLiveMatches(matchesData);
//             } catch (error) {
//                 console.error("L·ªói khi t·∫£i d·ªØ li·ªáu trang Home:", error);
//             } finally {
//                 setIsLoading(false);
//             }
//         };

//         loadAllHomeData();
//     }, []);

//     const now = new Date();
//     const liveTournaments = allTournaments.filter(t => new Date(t.startTimeUTC) <= now && new Date(t.endTimeUTC) > now);
//     const upcomingTournaments = allTournaments.filter(t => new Date(t.startTimeUTC) > now);

//     if (isLoading) {
//         return <div className="placeholder-content"><h1>Loading data...</h1></div>;
//     }

//     return (
//         <div className="home-container">
//             <div>
//                 <div className="section-header">
//                     <LiveIconNew />
//                     <h2>Live Tournaments</h2>
//                 </div>
//                 <div className="grid-container">
//                     {liveTournaments.slice(0, visibleLiveTournaments).map((t) =>
//                         <TournamentCard key={`live-${t.name}`} tournament={t} countdownTimers={countdownTimers} formatTime={formatTime} onViewDetails={setViewingTournament} />
//                     )}
//                 </div>
//                 {liveTournaments.length > visibleLiveTournaments && (
//                     <div className="view-more-container">
//                         <button onClick={() => setVisibleLiveTournaments(liveTournaments.length)} className="view-more-btn">View More</button>
//                     </div>
//                 )}
//             </div>

//             <div className="online-players-banner">
//                 <div className="text-center">
//                     <h3>PLAYERS ONLINE</h3>
//                     <p>{onlinePlayers.toLocaleString()}</p>
//                 </div>
//             </div>

//             <div>
//                 <div className="section-header">
//                     <UpcomingTournamentIcon />
//                     <h2>Upcoming Tournaments</h2>
//                 </div>
//                 <div className="grid-container">
//                     {upcomingTournaments.slice(0, visibleUpcomingTournaments).map((t) =>
//                         <TournamentCard key={`upcoming-${t.name}`} tournament={t} countdownTimers={countdownTimers} formatTime={formatTime} onViewDetails={setViewingTournament} />
//                     )}
//                 </div>
//                 {upcomingTournaments.length > visibleUpcomingTournaments && (
//                     <div className="view-more-container">
//                         <button onClick={() => setVisibleUpcomingTournaments(upcomingTournaments.length)} className="view-more-btn">View More</button>
//                     </div>
//                 )}
//             </div>

//             <div>
//                 <div className="section-header">
//                     <LiveMatchIcon />
//                     <h2>Live Matches</h2>
//                 </div>
//                 <div className="live-match-grid">
//                     {liveMatches.map((match, index) => (
//                         <LiveMatchCard key={index} match={match} />
//                     ))}
//                 </div>
//             </div>
//         </div>
//     );
// };

// export default Home;
import React, { useState, useEffect } from 'react';
import './home.css';

// [X√ìA B·ªé] Kh√¥ng c·∫ßn import c√°c h√†m API c≈© t·ª´ file ri√™ng n·ªØa
// import { fetchTournaments } from '../../api/tournaments.js';
// import { fetchLiveMatches } from '../../api/matches.js';

// Import c√°c component con c·ªßa b·∫°n v·∫´n ƒë∆∞·ª£c gi·ªØ nguy√™n
import TournamentCard from '../tournament_card/TournamentCard.jsx';
import LiveMatchCard from './LiveMatchCard.jsx';

// --- ICONS (gi·ªØ nguy√™n) ---
const LiveIconNew = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="icon icon-red animate-pulse" viewBox="0 0 24 24" fill="currentColor"><path fillRule="evenodd" d="M12 1.5a1.05 1.05 0 100 2.1 1.05 1.05 0 000-2.1zM10.23 15.795a.75.75 0 001.06 0l4.5-4.5a.75.75 0 00-1.06-1.06L11.25 13.19l-1.97-1.97a.75.75 0 00-1.06 1.06l2.5 2.5z" clipRule="evenodd" /></svg> );
const UpcomingTournamentIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="icon icon-blue"><path fillRule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z" clipRule="evenodd" /></svg> );
const LiveMatchIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="icon icon-red"><path d="M4.5 9.75a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM12 9.75a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM19.5 9.75a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM4.5 16.5a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM12 16.5a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5zM19.5 16.5a1.5 1.5 0 011.5-1.5h1.5a1.5 1.5 0 011.5 1.5v1.5a1.5 1.5 0 01-1.5 1.5h-1.5a1.5 1.5 0 01-1.5-1.5v-1.5z" /></svg> );


const Home = ({ onlinePlayers, countdownTimers, formatTime, setViewingTournament }) => {
    const [allTournaments, setAllTournaments] = useState([]);
    const [liveMatches, setLiveMatches] = useState([]);
    const [isLoading, setIsLoading] = useState(true);

    const [visibleLiveTournaments, setVisibleLiveTournaments] = useState(3);
    const [visibleUpcomingTournaments, setVisibleUpcomingTournaments] = useState(3);
    
    // [CH·ªàNH S·ª¨A] D√πng useEffect ƒë·ªÉ g·ªçi API th·∫≠t v√† ƒë·ªìng nh·∫•t d·ªØ li·ªáu
    useEffect(() => {
        const loadAllHomeData = async () => {
            setIsLoading(true);
            console.log("üìù [INFO] Home.jsx: B·∫Øt ƒë·∫ßu l·∫•y d·ªØ li·ªáu Tournaments v√† Live Matches t·ª´ API...");
            try {
                // G·ªçi ƒë·ªìng th·ªùi c√°c API ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô t·∫£i
                const [tournamentsRes, matchesRes] = await Promise.all([
                    fetch('https://f2farena.com/api/tournaments/?offset=0&limit=5'),
                    fetch('https://f2farena.com/api/matches/active').then(res => res.json()) // Gi·∫£ ƒë·ªãnh API cho matches
                ]);

                if (!tournamentsRes.ok) {
                    console.warn(`‚ö†Ô∏è [WARN] API Tournaments tr·∫£ v·ªÅ l·ªói! Status: ${tournamentsRes.status}`);
                    throw new Error('API request for tournaments failed');
                }

                const tournamentsData = await tournamentsRes.json();
                console.log("[INFO] D·ªØ li·ªáu Tournaments g·ªëc t·ª´ API:", tournamentsData);
                
                // --- B∆Ø·ªöC ƒê·ªíNG NH·∫§T D·ªÆ LI·ªÜU ---
                const formattedTournaments = tournamentsData.map(apiTournament => {
                    return {
                        id: apiTournament.id, // Gi·ªØ l·∫°i id
                        name: apiTournament.title, // title -> name
                        prize: `${apiTournament.prize_pool.toLocaleString('en-US')} USDT`, // prize_pool -> prize (ƒë·ªãnh d·∫°ng l·∫°i)
                        participants: apiTournament.participants, // Gi·ªØ nguy√™n
                        image: apiTournament.thumbnail, // thumbnail -> image
                        startTimeUTC: apiTournament.event_time, // event_time -> startTimeUTC
                        endTimeUTC: apiTournament.end_time, // end_time -> endTimeUTC
                        // Gi·ªØ l·∫°i c√°c tr∆∞·ªùng h·ªØu √≠ch kh√°c t·ª´ API
                        status: apiTournament.status, 
                        timeRemaining: apiTournament.timeRemaining
                    };
                });
                console.log("[INFO] D·ªØ li·ªáu Tournaments sau khi ƒë·ªìng nh·∫•t:", formattedTournaments);

                setAllTournaments(formattedTournaments);
                setLiveMatches(matchesRes); // Gi·∫£ ƒë·ªãnh matchesData ƒë√£ ƒë√∫ng ƒë·ªãnh d·∫°ng
                
                console.log("‚úÖ [SUCCESS] Home.jsx: ƒê√£ t·∫£i v√† ƒë·ªìng nh·∫•t d·ªØ li·ªáu th√†nh c√¥ng.");

            } catch (error) {
                console.error("‚ùå [ERROR] L·ªói khi t·∫£i d·ªØ li·ªáu trang Home:", error);
                setAllTournaments([]);
                setLiveMatches([]);
            } finally {
                setIsLoading(false);
            }
        };

        loadAllHomeData();
    }, []);

    const now = new Date();
    // Logic l·ªçc kh√¥ng c·∫ßn thay ƒë·ªïi v√¨ d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c ƒë·ªìng nh·∫•t
    const liveTournaments = allTournaments.filter(t => new Date(t.startTimeUTC) <= now && new Date(t.endTimeUTC) > now);
    const upcomingTournaments = allTournaments.filter(t => new Date(t.startTimeUTC) > now);

    if (isLoading) {
        return <div className="placeholder-content"><h1>Loading data...</h1></div>;
    }

    return (
        <div className="home-container">
            {/* Ph·∫ßn giao di·ªán kh√¥ng c·∫ßn thay ƒë·ªïi v√¨ d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c ƒë·ªìng nh·∫•t */}
            <div>
                <div className="section-header">
                    <LiveIconNew />
                    <h2>Live Tournaments</h2>
                </div>
                <div className="grid-container">
                    {liveTournaments.slice(0, visibleLiveTournaments).map((t) =>
                        <TournamentCard key={`live-${t.name}`} tournament={t} countdownTimers={countdownTimers} formatTime={formatTime} onViewDetails={setViewingTournament} />
                    )}
                </div>
                {liveTournaments.length > visibleLiveTournaments && (
                    <div className="view-more-container">
                        <button onClick={() => setVisibleLiveTournaments(liveTournaments.length)} className="view-more-btn">View More</button>
                    </div>
                )}
            </div>

            <div className="online-players-banner">
                <div className="text-center">
                    <h3>PLAYERS ONLINE</h3>
                    <p>{onlinePlayers.toLocaleString()}</p>
                </div>
            </div>

            <div>
                <div className="section-header">
                    <UpcomingTournamentIcon />
                    <h2>Upcoming Tournaments</h2>
                </div>
                <div className="grid-container">
                    {upcomingTournaments.slice(0, visibleUpcomingTournaments).map((t) =>
                        <TournamentCard key={`upcoming-${t.name}`} tournament={t} countdownTimers={countdownTimers} formatTime={formatTime} onViewDetails={setViewingTournament} />
                    )}
                </div>
                {upcomingTournaments.length > visibleUpcomingTournaments && (
                    <div className="view-more-container">
                        <button onClick={() => setVisibleUpcomingTournaments(upcomingTournaments.length)} className="view-more-btn">View More</button>
                    </div>
                )}
            </div>

            <div>
                <div className="section-header">
                    <LiveMatchIcon />
                    <h2>Live Matches</h2>
                </div>
                <div className="live-match-grid">
                    {liveMatches.map((match, index) => (
                        <LiveMatchCard key={index} match={match} />
                    ))}
                </div>
            </div>
        </div>
    );
};

export default Home;